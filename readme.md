# Visual-Aids: 为视障人士提供视觉辅助的系统

## **项目概述**
Visual-Aids 项目旨在帮助视障人士日常出行和活动。通过实时图像处理、目标检测、文本识别和语音合成，提供用户关于周围环境的语音指导。本系统模块化设计，具有良好的扩展性，并经过优化以便于在移动设备上部署。

### **核心功能**
- **实时目标检测**：识别用户路径中的障碍物、车辆和其他物体，并估算距离。
- **文本识别**：识别环境中的文本，例如公交车号、地铁标志等。
- **语音输出**：将检测到的物体或识别到的文本转化为语音，帮助用户理解周围环境。
- **优先级管理**：根据物体类型和距离进行优先级排序，确保最重要的信息优先播报。
- **路径导航（待实现）**：规划步行路径，用户偏离路径时提供提醒。
- **轻量化部署**：使用轻量化模型（如 YOLOv11s）和量化技术，优化移动设备的性能。

## **项目结构**

```
Visual-Aids
│
├── data/                  # 数据目录（如模型文件、临时数据）
├── docs/                  # 项目文档
├── logs/                  # 日志目录
│   ├── app.log            # 主程序日志
│   ├── audio/             # 语音输出 mp3 文件
├── models/                # 模型文件目录
│   ├── tts_engine/        # 文字转语音引擎模型
│   │   ├── ffmpeg.exe     # FFmpeg 可执行文件
│   │   ├── ffplay.exe     # FFplay 可执行文件
│
├── src/                   # 核心源码
│   ├── camera/            # 相机捕获模块
│   │   ├── __init__.py
│   │   ├── camera.py
│   │   ├── camera_config.py
│   │   ├── threaded_camera.py
│   │
│   ├── controller/        # 控制器模块
│   │   ├── __init__.py
│   │   ├── detection_controller.py
│   │
│   ├── detector/          # 目标检测模块
│   │   ├── __init__.py
│   │   ├── yolo_config.py
│   │   ├── detection_config.py
│   │   ├── detection_utils.py
│   │   ├── yolo.py
│   │
│   ├── ocr/               # 文本识别模块（OCR）
│   │   ├── __init__.py
│   │   ├── ocr.py         # OCR 功能实现
│   │   ├── ocr_config.py  # OCR 配置文件
│   │
│   ├── tts/               # 文字转语音模块（TTS）
│   │   ├── __init__.py
│   │   ├── tts.py         # 语音合成模块
│   │   ├── TTSEngine.py   # 语音引擎接口
│   │   ├── tts_config.py
│   │
│   ├── utils/             # 工具函数与配置模块
│   │   ├── __init__.py
│   │   ├── config.py
│   │   ├── logger.py      # 日志记录
│   │   ├── resource_manager.py # 资源管理
│   │
│   ├── main.py            # 主程序脚本
│   ├── env_test.py        # 环境测试脚本
│
├── requirements.txt       # Python 依赖项
├── .gitignore             # Git 忽略规则
├── .gitattributes         # Git 属性配置
```

---

## **模块说明**

### **1. 相机模块**
- **用途**：捕获相机视频帧并进行预处理，以便后续处理。
- **关键文件**：
  - `camera.py`: 处理视频捕获、预处理和缓冲。
  - `camera_config.py`: 包含相机相关配置（如分辨率、帧率）。
  - `threaded_camera.py`: 线程化视频捕获，提高性能。
- **功能**：
  - 可调整分辨率和帧率。
  - 提供实时预处理以提高目标检测和文本识别的准确性。
  - 线程化架构，提高视频捕获效率。

---

### **2. 目标检测模块**
- **用途**：使用 YOLO 模型对视频帧中的目标进行检测并估算距离。
- **关键文件**：
  - `yolo.py`: 基于 YOLOv11s 实现目标检测。
  - `yolo_config.py`: 定义检测配置（如模型路径、信度阈值）。
  - `detection_config.py`: 配置检测系统参数（如队列大小、优先级）。
  - `detection_utils.py`: 检测结果处理和格式化工具。
- **功能**：
  - 轻量化 YOLO 模型，支持实时检测。
  - 按目标类别过滤检测结果（如公交车、行人）。
  - 精确估算障碍物距离，优化用户体验。
  - 支持绘制边界框和标签，便于调试和可视化。

---

### **3. 控制器模块**
- **用途**：整合目标检测和TTS模块，管理检测流程和语音输出。
- **关键文件**：
  - `detection_controller.py`: 处理帧、管理检测结果和语音播报。
- **功能**：
  - 检测结果队列管理，支持历史比对。
  - 优先级调度，确保重要信息优先播报。
  - 语音播报节流，避免信息过载。

---

### **4. 文本识别模块（OCR）**
- **用途**：从视频帧中识别文本信息，例如公交车号和地铁标志。
- **关键文件**：
  - `ocr.py`: 使用 PaddleOCR 实现 OCR 功能。
  - `ocr_config.py`: 包含 OCR 模块的配置。
- **功能**：
  - 图像预处理优化，提高识别精度。
  - 支持多语种文本识别（如中文、英文）。
  - 文本清理和格式化，便于语音播报。

#### **OCR 安装指南**
1. **PaddleOCR**：
   - 安装 PaddleOCR：
     ```bash
     pip install paddleocr paddlepaddle
     ```
   - 如需 GPU 加速，请参考 [PaddleOCR 文档](https://github.com/PaddlePaddle/PaddleOCR)。

---

### **5. 文字转语音模块**
- **用途**：将文字转化为语音，提供语音指导。
- **关键文件**：
  - `tts.py`: 实现文字转语音功能，使用 gTTS 在线服务。
  - `TTSEngine.py`: 优化 TTS 引擎，支持队列处理和中断控制。
  - `tts_config.py`: 管理 TTS 配置，例如语言、语速和音量。
- **功能**：
  - 实时语音反馈，支持多线程播放。
  - 优先级控制，重要信息优先播报。
  - 支持中断当前播报，确保关键信息及时传达。
  - 支持多语种（如中文、英文）。

---

### **6. 工具模块**
- **用途**：提供实用函数、日志记录和全局配置管理。
- **关键文件**：
  - `logger.py`: 设置和管理模块的日志记录。
  - `config.py`: 集中管理全局配置。
  - `resource_manager.py`: 统一管理资源初始化和释放。
- **功能**：
  - 配置化日志记录，便于调试和错误追踪。
  - 资源管理，确保优雅启动和关闭。
  - 简化模块集成。

---

### **7. 主程序**
- **用途**：整合所有模块，实现系统的核心功能。
- **关键文件**：
  - `main.py`: 包含主程序循环，用于实时目标检测、文本识别和语音播报。
  - `env_test.py`: 环境测试脚本，验证依赖项和功能。
- **功能**：
  - 捕获相机视频帧。
  - 检测目标并提取文本信息。
  - 通过文字转语音模块提供语音反馈。
  - 优雅处理异常和资源释放。

---

## **当前进度与未来计划**

### **已完成**
- 相机捕获和预处理，包括线程化视频捕获。
- 使用 YOLO 进行目标检测和距离估算。
- 集成文字转语音模块，提供实时语音反馈。
- 实现 OCR 功能，用于文本识别。
- 检测结果优先级排序和语音播报控制。
- 完善的资源管理和异常处理。

### **未来计划**
- 完善 OCR 逻辑以及 OCR 转语音逻辑。
- 增加导航功能，提供路径偏离提醒。
- 优化模型以支持移动端部署（如 TensorFlow Lite 和 ONNX）。
- 提高物体距离估算的准确性。
- 增强 TTS 播报的自然度和流畅性。

---

## **如何运行项目**

1. **安装依赖项**：
   ```bash
   pip install -r requirements.txt
   ```

2. **环境测试**：
   ```bash
   python src/env_test.py
   ```
   确保所有依赖项都正确安装。

3. **准备环境**：
   - 确保 YOLO 模型文件位于 `models/` 目录中。
   - 检查 `models/tts_engine/` 目录中是否包含 ffmpeg.exe 和 ffplay.exe。

4. **运行程序**：
   ```bash
   python src/main.py
   ```

5. **调整配置**：
   - 在 `src/config.py` 或模块专用的 `*_config.py` 文件中修改设置。

